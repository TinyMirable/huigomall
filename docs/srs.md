# IEEE-模板

IEEE 系统需求规格说明模板

# 软件需求规格说明

## 项目名称：线上购物商城系统（TheMall）

版本 1.0 已批准
编制人：待定
`<organization>`
`<date created>`

目录
====

* [修订历史](#revision-history)
* [引言](#1-introduction)
  * 1.1 [目的](#11-purpose)
  * 1.2 [文档约定](#12-document-conventions)
  * 1.3 [预期读者和阅读建议](#13-intended-audience-and-reading-suggestions)
  * 1.4 [产品范围](#14-product-scope)
  * 1.5 [参考文献](#15-references)
* [总体描述](#overall-description)
  * 2.1 [产品视角](#21-product-perspective)
  * 2.2 [产品功能](#22-product-functions)
  * 2.3 [用户类别和特征](#23-user-classes-and-characteristics)
  * 2.4 [运行环境](#24-operating-environment)
  * 2.5 [设计和实现约束](#25-design-and-implementation-constraints)
  * 2.6 [用户文档](#26-user-documentation)
  * 2.7 [假设和依赖关系](#27-assumptions-and-dependencies)
* [外部接口需求](#external-interface-requirements)
  * 3.1 [用户接口](#31-user-interfaces)
  * 3.2 [硬件接口](#32-hardware-interfaces)
  * 3.3 [软件接口](#33-software-interfaces)
  * 3.4 [通信接口](#34-communications-interfaces)
* [系统特性](#system-features)
  * 4.1 [系统特性 1](#41-system-feature-1)
  * 4.2 [系统特性 2（以此类推）](#42-system-feature-2-and-so-on)
* [其他非功能性需求](#other-nonfunctional-requirements)
  * 5.1 [性能需求](#51-performance-requirements)
  * 5.2 [安全性需求](#52-safety-requirements)
  * 5.3 [安全需求](#53-security-requirements)
  * 5.4 [软件质量属性](#54-software-quality-attributes)
  * 5.5 [业务规则](#55-business-rules)
* [其他需求](#other-requirements)
* [附录 A：术语表](#appendix-a-glossary)
* [附录 B：分析模型](#appendix-b-analysis-models)
* [附录 C：待确定事项列表](#appendix-c-to-be-determined-list)

## 修订历史

| 姓名     | 日期       | 变更原因         | 版本 |
| -------- | ---------- | ---------------- | ---- |
| 初始版本 | 2025-12-22 | 初始需求规格说明 | 1.0  |
| 需求补充 | 2025-12-22 | 补充用户认证、商品状态、订单确认收货、退货退款、优惠券、审计日志等需求 | 1.1  |
| 需求细化 | 2025-12-22 | 明确订单快照、库存原子操作、并发控制、退款状态、订单自动取消等业务规则和实现约束 | 1.2  |
| 角色分离 | 2025-12-26 | 将商家和管理员角色分离，明确商家注册审核、店铺管理、商品管理、订单管理、退款审核、销售报表等权限划分 | 1.3  |

## 1. 引言

### 1.1 目的

本文档是线上购物商城系统（TheMall）的软件需求规格说明（SRS）版本 1.0。本文档详细描述了系统的功能需求、非功能需求、接口需求等，为系统设计、开发、测试和验收提供依据。

本 SRS 涵盖整个线上购物商城系统的第一阶段功能，包括用户注册登录、商品浏览、购物车管理、订单处理、支付集成、销售管理等核心功能。

### 1.2 文档约定

- **优先级标识**：高优先级（P1）、中优先级（P2）、低优先级（P3）
- **需求编号**：采用"FR-X.Y.Z"格式，其中X为系统特性编号，Y为子特性编号，Z为具体需求编号
- **待确定事项**：使用"TBD"标记，表示该需求需要进一步确认
- **阶段标识**：第一阶段（Phase 1）为必须实现的功能，后续阶段（Future）为预留功能

### 1.3 预期读者和阅读建议

本文档面向以下读者：

- **开发人员**：重点关注第3、4、5节，了解系统接口和功能需求
- **项目经理**：重点关注第1、2、5节，了解项目范围和约束
- **测试人员**：重点关注第4节，了解功能需求和验收标$$准
- **产品经理**：重点关注第2、4节，了解产品功能和用户需求

建议阅读顺序：

1. 第1节（引言）- 了解文档结构和项目背景
2. 第2节（总体描述）- 了解产品整体情况
3. 第4节（系统特性）- 详细了解功能需求
4. 第3、5节（接口需求和非功能需求）- 了解技术约束

### 1.4 产品范围

线上购物商城系统（TheMall）是一个基于Web的B2C电子商务平台，旨在为用户提供便捷的在线购物体验，为销售管理人员提供商品和订单管理功能。

**主要目标**：

- 为用户提供商品浏览、购买、订单管理等完整的购物体验
- 为销售经理提供商品管理、订单管理、销售报表等管理功能
- 支持在线支付、库存管理、订单状态跟踪等核心电商功能

**产品收益**：

- 提升用户购物体验，支持7×24小时在线购物
- 提高销售管理效率，实现商品和订单的集中管理
- 提供数据分析和报表功能，支持业务决策

### 1.5 参考文献

- Spring Boot 官方文档：https://spring.io/projects/spring-boot
- Vue.js 官方文档：https://vuejs.org/
- DaisyUI 组件库文档：https://daisyui.com/
- IEEE 830-1998 软件需求规格说明标准

## 2. 总体描述

### 2.1 产品视角

线上购物商城系统（TheMall）是一个全新的独立Web应用系统，采用前后端分离架构。系统主要包含以下组件：

- **前端应用**：基于Vue.js的用户界面，提供商品浏览、购物车、订单管理等用户功能
- **后端服务**：基于Spring Boot的RESTful API服务，处理业务逻辑和数据管理
- **数据库**：存储用户、商品、订单等业务数据
- **外部接口**：支付接口（微信/支付宝）、邮件服务接口、短信服务接口

系统架构采用经典的三层架构：表现层（前端）、业务逻辑层（后端API）、数据访问层（数据库）。

### 2.2 产品功能

系统主要功能模块如下：

**用户端功能（顾客）**：

- 用户注册、登录、注销（手机号/邮箱验证码验证，支持短信验证码免密码登录）
- 忘记密码功能（通过验证码重置密码）
- 商品浏览（列表展示、详情查看、分类筛选、排序）
- 购物车管理（添加、删除、修改数量、持久化存储）
- 订单管理（创建订单、查看订单历史、订单状态跟踪、取消订单、确认收货）
- 退货退款（申请退款、选择退款原因、查看退款状态）
- 收货地址管理（添加、编辑、删除、设为默认）
- 个人中心（查看个人信息、修改个人信息、修改密码）
- 支付功能（集成第三方支付平台）
- 优惠券管理（查看优惠券、使用优惠券）

**管理端功能（系统管理员）**：

- 商家管理（商家注册审核、商家状态管理、审核开关配置）
- 店铺管理（店铺审核、店铺状态管理、审核开关配置）
- 商品分类管理（全局商品分类的增删改查）
- 订单管理（查看所有订单、订单详情查看）
- 销售报表（全平台销售额统计、订单数量统计、商品销量统计、图表展示）
- 退款审核（审核所有退款申请）
- 操作审计日志（查看所有操作日志，包括管理员和商家操作）

**商家端功能（商家）**：

- 店铺管理（创建店铺、编辑店铺、删除店铺、店铺状态管理，最多3个店铺）
- 商品管理（商品信息的增删改查、商品上架/下架、库存管理、商品分类创建）
- 订单管理（查看自己店铺的订单、订单详情查看）
- 销售报表（自己店铺的销售额统计、订单数量统计、商品销量统计、图表展示）
- 退款审核（审核自己店铺的退款申请）
- 操作审计日志（查看自己的操作历史）

**系统功能**：

- 优惠券系统（8折优惠券，每个新账号10张，可选择使用）
- 邮件/短信通知（订单确认、发货通知、退款通知）
- 库存管理（库存扣减、库存预警）
- Redis缓存（商品列表、商品详情等热门数据）

### 2.3 用户类别和特征

系统包含以下用户类别：

**1. 顾客（Customer）**

- **特征**：普通消费者，通过Web浏览器访问系统
- **权限**：浏览商品、购买商品、管理自己的订单和个人信息
- **使用频率**：根据购物需求，使用频率不定
- **技术能力**：基本Web操作能力
- **重要性**：高优先级用户，系统的主要服务对象

**2. 系统管理员（System Administrator）**

- **特征**：系统平台管理员，负责平台整体管理和商家审核
- **权限**：
  - 商家注册审核（可设置审核开关）
  - 商家状态管理（启用/禁用商家）
  - 店铺审核（可设置审核开关）
  - 店铺状态管理（可管理所有店铺状态）
  - 商品分类管理（管理全局商品分类）
  - 查看所有订单
  - 查看全平台销售报表
  - 审核所有退款申请
  - 查看所有操作审计日志
- **使用频率**：日常使用，频率较高
- **技术能力**：具备基本的系统操作能力
- **账户管理**：由系统管理员手动创建（通过数据库或配置文件），不支持自主注册
- **重要性**：高优先级用户，系统的核心管理角色

**3. 商家（Merchant）**

- **特征**：可开设店铺的商家用户，通过申请成为商家
- **权限**：
  - 店铺管理（创建、编辑、删除店铺，最多3个店铺，店铺状态管理）
  - 商品管理（商品的增删改查、上架/下架、库存管理、商品分类创建）
  - 查看自己店铺的订单
  - 查看自己店铺的销售报表
  - 审核自己店铺的退款申请
  - 查看自己的操作审计日志
- **使用频率**：日常使用，频率较高
- **技术能力**：具备基本的系统操作能力
- **账户管理**：用户申请成为商家，由系统管理员审核通过后获得商家权限
- **重要性**：高优先级用户，系统的核心业务角色

### 2.4 运行环境

**前端运行环境**：

- 现代Web浏览器（Chrome、Firefox、Safari、Edge等最新版本）
- 支持JavaScript和HTML5的浏览器环境

**后端运行环境**：

- Java运行环境：JDK 11或更高版本
- Web服务器：内嵌Tomcat（Spring Boot默认）
- 操作系统：Windows、Linux、macOS

**数据库环境**：

- 关系型数据库（MySQL 8.0+ 或 PostgreSQL 12+）
- 支持事务和并发访问

**部署环境**：

- 支持Docker容器化部署（推荐）
- 或传统服务器部署方式

### 2.5 设计和实现约束

**技术栈约束**：

- **后端**：必须使用Spring Boot框架，Java语言开发
- **前端**：必须使用Vue 3 + TypeScript + Vite构建
- **UI组件库**：使用DaisyUI样式库
- **架构**：前后端分离架构，通过RESTful API通信
- **缓存**：使用Redis缓存热门数据（商品列表、商品详情等）

**开发约束**：

- 遵循RESTful API设计规范
- 代码需符合Java和TypeScript编码规范
- 使用Git进行版本控制

**业务约束**：

- 第一阶段统一商品价格为0.01元（测试支付功能）
- 支付方式第一阶段仅实现一种（微信或支付宝）
- 不支持实际物流跟踪，订单发货后直接通知用户
- 收货地址不进行真实性验证

**安全约束**：

- 用户密码需加密存储
- 敏感操作需验证码验证
- API接口需进行身份认证和授权

### 2.6 用户文档

系统将提供以下用户文档：

- **用户使用手册**：面向顾客的操作指南，包括注册、购物、订单管理等流程说明
- **管理员操作手册**：面向销售经理的管理功能操作指南
- **API接口文档**：面向开发人员的接口说明文档（Swagger/OpenAPI格式）
- **系统部署文档**：面向运维人员的系统部署和配置说明

文档格式：在线文档（Markdown格式）和PDF格式。

### 2.7 假设和依赖关系

**假设**：

- 用户具备基本的Web浏览器使用能力
- 用户拥有有效的手机号或邮箱用于接收验证码
- 网络连接稳定，能够正常访问Web应用
- 第三方支付服务（微信/支付宝）可用且稳定
- 邮件服务可用，能够正常发送邮件通知

**外部依赖**：

- **支付服务**：微信支付或支付宝支付API（第一阶段选择一种）
- **邮件服务**：SMTP邮件服务（用于发送订单确认和发货通知）
- **短信服务**：短信验证码服务（用于用户注册和密码修改验证，第一阶段可选）
- **数据库**：MySQL或PostgreSQL数据库系统

**第三方库依赖**：

- Spring Boot生态系统（Spring Security、Spring Data JPA等）
- Vue.js生态系统（Vue Router、Pinia/Vuex等）
- DaisyUI组件库
- 其他必要的npm和Maven依赖包

## 3. 外部接口需求

### 3.1 用户接口

**界面设计原则**：

- 采用响应式设计，适配不同屏幕尺寸（桌面端为主，移动端基本适配）
- 遵循DaisyUI设计规范，保持界面风格统一
- 界面简洁直观，操作流程清晰
- 支持中文界面

**主要界面页面**：

**用户端界面**：

- **首页**：商品分类导航、热门商品展示、轮播图
- **商品列表页**：商品卡片展示、分类筛选、分页显示
- **商品详情页**：商品详细信息、图片展示、库存显示、加入购物车/立即购买按钮、库存预警提示
- **购物车页**：购物车商品列表、数量修改、删除、结算按钮
- **订单确认页**：订单商品信息、收货地址选择、订单金额、支付方式选择
- **订单列表页**：用户所有订单列表、订单状态、订单详情查看
- **订单详情页**：订单完整信息、订单状态、收货信息
- **个人中心页**：个人信息展示、订单管理入口、地址管理入口、密码修改入口
- **收货地址管理页**：地址列表、添加/编辑/删除地址、设置默认地址
- **登录/注册页**：手机号/邮箱登录、验证码输入、注册表单

**管理端界面**：

- **商品管理页**：商品列表、搜索、添加/编辑/删除商品、库存预警提示
- **商品编辑页**：商品信息表单（名称、价格、库存、描述、图片URL、分类）
- **订单管理页**：所有订单列表、订单状态筛选、订单详情查看、状态更新
- **销售报表页**：销售额/订单数/商品销量统计数字、过去一个月折线图

**通用界面元素**：

- 顶部导航栏：Logo、用户信息、购物车图标、退出登录
- 底部页脚：版权信息、联系方式
- 错误提示：统一的错误消息显示样式
- 成功提示：操作成功后的提示信息
- 加载状态：数据加载时的loading动画

### 3.2 硬件接口

系统为纯软件应用，不直接与硬件设备交互。系统运行在标准服务器硬件上，通过Web服务器提供HTTP服务。

**服务器硬件要求**（建议）：

- CPU：2核或以上
- 内存：4GB或以上
- 存储：50GB或以上可用空间
- 网络：稳定的互联网连接

### 3.3 软件接口

**数据库接口**：

- **数据库类型**：MySQL 8.0+ 或 PostgreSQL 12+
- **连接方式**：JDBC连接
- **ORM框架**：Spring Data JPA
- **数据内容**：用户信息、商品信息、订单信息、购物车信息、地址信息等

**前端-后端接口**：

- **通信协议**：HTTP/HTTPS
- **数据格式**：JSON
- **API风格**：RESTful API
- **认证方式**：JWT Token或Session

**支付接口**：

- **微信支付API**：微信支付开放平台API（第一阶段可选）
- **支付宝API**：支付宝开放平台API（第一阶段可选）
- **接口协议**：HTTPS
- **数据格式**：JSON/XML（根据支付平台要求）

**邮件服务接口**：

- **协议**：SMTP
- **服务提供商**：TBD（如QQ邮箱、163邮箱、SendGrid等）
- **用途**：发送订单确认邮件、发货通知邮件

**短信服务接口**：

- **服务提供商**：TBD（如阿里云短信、腾讯云短信等）
- **协议**：HTTPS RESTful API
- **用途**：发送验证码（注册、登录、密码修改）

### 3.4 通信接口

**Web通信**：

- **协议**：HTTP/HTTPS
- **端口**：HTTP默认80，HTTPS默认443（生产环境建议使用HTTPS）
- **数据格式**：JSON
- **字符编码**：UTF-8

**邮件通信**：

- **协议**：SMTP
- **端口**：25（非加密）或465/587（SSL/TLS）
- **认证**：用户名密码认证
- **邮件格式**：HTML格式邮件，支持中文

**短信通信**：

- **协议**：HTTPS
- **数据格式**：JSON
- **认证**：API Key或Access Token

**安全要求**：

- 所有敏感数据传输必须使用HTTPS加密
- API接口需进行身份认证
- 用户密码等敏感信息需加密存储
- 验证码需设置有效期（建议5-10分钟）

## 4. 系统特性

系统功能按用户角色和业务流程组织，主要包含用户管理、商品管理、购物流程、订单管理、支付集成、销售管理等核心特性。

### 4.1 用户认证与授权

#### 4.1.1 描述和优先级

提供用户注册、登录、注销、忘记密码功能，支持手机号和邮箱两种注册方式（二选一即可），通过验证码进行身份验证。支持短信验证码免密码登录。系统区分顾客和系统管理员两种角色，实现基于角色的访问控制。

**优先级**：P1（高优先级）

#### 4.1.2 刺激/响应序列

**用户注册流程**：

1. 用户访问注册页面，选择注册方式（手机号或邮箱，二选一）
2. 用户输入手机号或邮箱，点击"获取验证码"
3. 系统发送验证码到用户手机或邮箱
4. 用户输入验证码、设置密码、确认密码
5. 系统验证验证码和密码格式，创建用户账户
6. 系统为新用户发放10张8折优惠券
7. 系统返回注册成功信息，自动登录或跳转登录页

**用户登录流程（密码登录）**：

1. 用户访问登录页面，选择"密码登录"
2. 用户输入手机号/邮箱和密码
3. 系统显示图片验证码，用户输入验证码（次优先级功能，第一阶段可选）
4. 系统验证用户凭证和图片验证码
5. 验证成功，系统创建会话，跳转到首页
6. 验证失败，系统返回错误提示

**用户登录流程（短信验证码登录）**：

1. 用户访问登录页面，选择"短信验证码登录"
2. 用户输入手机号，点击"获取验证码"
3. 系统发送短信验证码
4. 用户输入验证码
5. 系统验证验证码，验证成功创建会话，跳转到首页

**忘记密码流程**：

1. 用户在登录页点击"忘记密码"
2. 用户输入手机号或邮箱
3. 用户点击"获取验证码"
4. 系统发送验证码到用户手机或邮箱
5. 用户输入验证码和新密码、确认密码
6. 系统验证验证码和密码格式，更新密码
7. 系统返回密码重置成功，跳转到登录页

**用户注销流程**：

1. 用户点击"退出登录"
2. 系统清除用户会话
3. 跳转到登录页面或首页

#### 4.1.3 功能需求

- **FR-1.1**：系统应支持用户通过手机号注册，手机号格式验证，发送短信验证码
- **FR-1.2**：系统应支持用户通过邮箱注册，邮箱格式验证，发送邮件验证码
- **FR-1.3**：用户注册时手机号和邮箱二选一即可，不需要同时绑定
- **FR-1.4**：验证码有效期为10分钟，验证码为6位数字
- **FR-1.5**：系统应验证密码强度（至少8位，包含字母和数字）
- **FR-1.6**：系统应支持用户使用手机号/邮箱和密码登录
- **FR-1.7**：系统应支持用户使用手机号和短信验证码免密码登录
- **FR-1.8**：系统应支持图片验证码功能（次优先级P2，第一阶段可选实现）
- **FR-1.9**：系统应支持忘记密码功能，通过验证码重置密码
- **FR-1.10**：系统应支持用户注销登录，清除会话信息
- **FR-1.11**：系统应区分顾客、商家和系统管理员角色，系统管理员账户由管理员手动创建
- **FR-1.12**：系统应根据用户角色显示不同的功能菜单和页面
- **FR-1.13**：系统应对登录失败的尝试进行限制（如5次失败后锁定30分钟）
- **FR-1.14**：用户密码应加密存储（使用BCrypt等加密算法）
- **FR-1.15**：系统应支持用户申请成为商家
- **FR-1.16**：系统应支持系统管理员审核商家申请，管理员可以设置开启审核和不审核（审核开关）
- **FR-1.17**：系统应支持系统管理员管理商家状态（启用/禁用商家）

### 4.2 商品浏览与管理

#### 4.2.1 描述和优先级

提供商品信息的展示和管理功能。顾客可以浏览商品列表（支持排序）、查看商品详情、查看店铺信息；商家可以管理自己店铺的商品信息（增删改查）、设置商品上架/下架状态、创建商品分类；系统管理员可以管理全局商品分类、查看所有商品。

**优先级**：P1（高优先级）

#### 4.2.2 刺激/响应序列

**商品浏览流程**：

1. 用户访问首页或商品列表页
2. 系统展示上架商品列表（分页显示，默认按最新上架时间排序），显示店铺信息
3. 用户可以选择排序方式（价格升序/降序、销量、上架时间）
4. 用户点击商品分类，系统筛选对应分类商品
5. 用户点击店铺信息，系统展示该店铺的商品列表
6. 用户点击商品卡片，系统展示商品详情页
7. 商品详情页显示商品名称、价格、库存、描述、图片、分类、店铺信息等

**商品管理流程（商家）**：

1. 商家登录商家后台，进入商品管理页
2. 系统展示商家所有店铺的商品列表（包括上架、下架状态）
3. 商家选择店铺，点击"添加商品"，填写商品信息（名称、价格、库存、描述、图片URL、分类）
4. 系统验证商品信息，如果管理员开启了商品审核，则商品进入待审核状态；否则保存商品（默认状态为下架）
5. 商家可以编辑商品信息、设置商品上架/下架状态
6. 商家可以删除商品（删除前需确认，删除操作记录审计日志）
7. 商家可以创建商品分类
8. 系统监控库存，当库存≤50时，在商品详情页和管理页面显示预警

**商品分类管理流程（系统管理员）**：

1. 系统管理员登录管理后台，进入商品分类管理页
2. 系统展示全局商品分类树
3. 系统管理员可以添加、编辑、删除商品分类
4. 系统管理员可以管理商家创建的商品分类

#### 4.2.3 功能需求

- **FR-2.1**：系统应支持商品列表展示，支持分页（每页20条），显示店铺信息
- **FR-2.2**：系统应只展示上架状态的商品给普通用户，下架商品不可见
- **FR-2.3**：系统应支持按商品分类筛选商品
- **FR-2.4**：系统应支持商品排序功能（价格升序/降序、销量、上架时间），优先级P2（中优先级，基础功能实现后）
- **FR-2.5**：系统应支持商品详情页展示，包含名称、价格、库存、描述、图片URL、分类、店铺信息
- **FR-2.6**：系统应支持用户点击店铺信息，查看该店铺的商品列表
- **FR-2.7**：系统应支持商家添加商品，商品必须关联到店铺，必填字段：名称、价格、库存、分类
- **FR-2.8**：系统应支持商品创建审核功能，管理员可以设置开启审核或不审核（默认不审核）
- **FR-2.9**：系统应支持商品上架/下架状态管理，新添加商品默认为下架状态
- **FR-2.10**：系统应支持商家编辑商品信息
- **FR-2.11**：系统应支持商家删除商品（删除前需确认，记录审计日志）
- **FR-2.12**：系统应支持商家创建商品分类
- **FR-2.13**：系统应支持系统管理员管理全局商品分类（增删改查）
- **FR-2.14**：系统应在商品库存≤50时，在商品详情页显示库存预警提示
- **FR-2.15**：系统应在商品库存≤50时，在商家管理页面显示库存预警列表
- **FR-2.16**：系统应防止库存为0或负数的商品被购买
- **FR-2.17**：商品价格应为正数，库存应为非负整数
- **FR-2.18**：商品图片URL应进行格式验证
- **FR-2.19**：商品草稿功能为未来功能（P3低优先级），第一阶段不实现
- **FR-2.20**：商品下架后，用户仍可通过查找功能找到商品，但无法下单
- **FR-2.21**：商品下架和库存为0是两个独立的状态，商品下架不影响库存，库存为0的商品显示"无货"无法下单

### 4.3 购物车管理

#### 4.3.1 描述和优先级

提供购物车功能，用户可以将商品添加到购物车，管理购物车中的商品（修改数量、删除），购物车信息持久化存储。

**优先级**：P1（高优先级）

#### 4.3.2 刺激/响应序列

**添加到购物车流程**：

1. 用户在商品详情页选择商品数量，点击"加入购物车"
2. 系统验证用户是否登录，未登录则提示登录
3. 系统验证商品库存是否充足
4. 系统将商品添加到用户购物车（如已存在则更新数量）
5. 系统返回添加成功提示

**购物车管理流程**：

1. 用户访问购物车页面
2. 系统展示用户购物车中的所有商品
3. 用户可以修改商品数量（系统验证库存）
4. 用户可以删除购物车中的商品
5. 用户可以选择商品进行结算

#### 4.3.3 功能需求

- **FR-3.1**：系统应支持用户将商品添加到购物车（需登录）
- **FR-3.2**：系统应支持购物车商品数量修改，修改时验证库存
- **FR-3.3**：系统应支持从购物车删除商品
- **FR-3.4**：系统应将购物车信息持久化存储到数据库
- **FR-3.5**：系统应在用户登录后自动加载购物车历史记录
- **FR-3.6**：系统应显示购物车中商品的总金额
- **FR-3.7**：系统应防止添加库存不足的商品到购物车
- **FR-3.8**：系统应在商品库存变化时，更新购物车中对应商品的可用性提示

### 4.4 订单管理

#### 4.4.1 描述和优先级

提供订单创建、查看、状态跟踪、取消、确认收货、退货退款等功能。顾客可以创建订单、查看订单历史、跟踪订单状态、确认收货、申请退款；商家可以查看自己店铺的订单、审核自己店铺的退款；系统管理员可以查看所有订单、审核所有退款。订单可以包含不同店铺的商品，订单项按店铺区分。

**优先级**：P1（高优先级）

#### 4.4.2 刺激/响应序列

**创建订单流程**：

1. 用户在购物车选择商品（可以包含不同店铺的商品），点击"结算"，或从商品详情页点击"立即购买"
2. 系统跳转到订单确认页，展示订单商品信息（按店铺分组显示）
3. 用户选择或添加收货地址
4. 用户可选择使用优惠券（8折优惠）
5. 系统计算订单总金额（应用优惠券后）
6. 用户确认订单信息，点击"提交订单"
7. 系统创建订单（状态：待付款），订单项按店铺区分，跳转到支付页面

**订单查看流程**：

1. 用户进入"我的订单"页面
2. 系统展示用户的所有订单列表
3. 用户点击订单，查看订单详情（商品信息、收货地址、订单状态、支付信息等）

**订单状态更新流程**：

1. 用户提交订单，系统检查库存
2. 如果库存充足，系统创建订单（状态：待付款），扣减库存（原子操作）
3. 如果库存不足，订单创建失败，订单状态为"已取消"，取消原因为"库存不足"
4. 用户完成支付，支付平台回调系统
5. 系统验证支付结果，支付成功后更新订单状态为"已付款"
6. 系统自动更新订单状态为"待发货"
7. 系统自动更新订单状态为"已发货"
8. 系统自动更新订单状态为"运输中"
9. 系统自动更新订单状态为"已送到"，并发送短信通知用户"商品已到达指定收货地址"（第一阶段简化流程）
10. 用户可以主动点击"确认收货"，订单状态更新为"已完成"
11. 如果用户未主动确认，系统在订单状态变为"已送到"后24小时自动更新订单状态为"已完成"
12. 用户可以在"待付款"和"待发货"状态取消订单
13. 订单创建后30分钟内未支付，系统自动取消订单，恢复库存，并通知用户

**退货退款流程**：

1. 用户在订单详情页点击"申请退款"（订单状态为"已付款"、"待发货"、"已发货"、"运输中"、"已送到"）
2. 用户选择退款原因，提交退款申请
3. 系统创建退款申请记录，退款申请状态为"待审核"
4. 商家和管理员收到退款申请通知
5. 商家可以审核自己店铺的退款申请（同意或拒绝）
6. 系统管理员可以审核所有退款申请（同意或拒绝）
7. 如果同意退款，系统处理退款，更新退款申请状态为"已同意"，更新订单状态为"已退款"，恢复商品库存，发送短信通知用户
8. 如果拒绝退款，系统更新退款申请状态为"已拒绝"，用户可查看拒绝原因
9. 7天无理由退款规则：订单完成7天内可申请退款
10. 自动退款规则：退款申请提交成功后，在配置的时间内（默认2分钟，可配置，主要用于测试）未确认，则自动同意退款
11. 退款成功后，商品库存恢复

#### 4.4.3 功能需求

- **FR-4.1**：系统应支持从购物车创建订单
- **FR-4.2**：系统应支持从商品详情页直接购买创建订单
- **FR-4.3**：订单应包含以下信息：订单号、商品列表（包含商品快照：商品名称、价格、图片等）、数量、单价、总金额、收货地址（订单创建时保存地址快照）、订单状态、创建时间
- **FR-4.4**：订单创建时应保存商品快照信息（商品名称、价格、图片等），确保商品信息变化时订单金额不变
- **FR-4.5**：订单状态包括：待付款、已付款、待发货、已发货、运输中、已送到、已完成、已取消、已退款
- **FR-4.6**：系统应支持用户查看自己的所有订单
- **FR-4.7**：系统应支持用户查看订单详情
- **FR-4.8**：系统应支持用户取消订单（仅限"待付款"和"待发货"状态）
- **FR-4.9**：系统应支持用户确认收货功能，用户可在"已送到"状态主动点击"确认收货"，订单状态更新为"已完成"
- **FR-4.10**：系统应在订单状态变为"已送到"后24小时自动确认收货（如果用户未主动确认）
- **FR-4.11**：订单支付成功后，系统应自动更新订单状态为"已送到"，并发送短信通知用户"商品已到达指定收货地址"（第一阶段简化流程）
- **FR-4.12**：系统应支持系统管理员查看所有订单
- **FR-4.13**：系统应支持商家查看自己店铺的订单
- **FR-4.14**：系统应支持订单包含不同店铺的商品，订单项按店铺区分
- **FR-4.15**：系统应支持商家只能看到自己店铺的订单项
- **FR-4.16**：订单提交时，系统应检查商品库存，库存充足则创建订单并扣减库存（原子操作），库存不足则订单创建失败，订单状态为"已取消"，取消原因为"库存不足"
- **FR-4.17**：库存扣减必须是原子操作，确保并发下单时库存扣减正确
- **FR-4.18**：订单取消时，系统应恢复商品库存
- **FR-4.19**：订单创建后30分钟内未支付，系统应自动取消订单，恢复库存，并通知用户（30分钟时间可配置）
- **FR-4.20**：系统应生成唯一的订单号（格式：TBD）
- **FR-4.21**：订单支付成功后，系统应自动发送邮件通知用户
- **FR-4.22**：系统应支持退货退款功能（优先级P2中优先级）
- **FR-4.23**：退款申请应有独立的状态：待审核、已同意、已拒绝
- **FR-4.24**：用户申请退款时，应选择退款原因
- **FR-4.25**：商家应能审核自己店铺的退款申请（同意或拒绝）
- **FR-4.26**：系统管理员应能审核所有退款申请（同意或拒绝）
- **FR-4.27**：退款成功后，系统应更新退款申请状态为"已同意"，更新订单状态为"已退款"，恢复商品库存，发送短信通知用户，并处理退款
- **FR-4.28**：系统应支持7天无理由退款规则，订单完成7天内可申请退款
- **FR-4.29**：退款申请提交成功后，在配置的时间内（默认2分钟，可配置，主要用于测试）未确认，则自动同意退款

### 4.5 支付集成

#### 4.5.1 描述和优先级

集成第三方支付平台（微信支付或支付宝），实现订单支付功能。第一阶段使用支付平台沙箱环境进行测试，支付回调需实现幂等性处理。

**优先级**：P1（高优先级）

#### 4.5.2 刺激/响应序列

**支付流程**：

1. 用户提交订单，系统检查库存
2. 如果库存充足，系统创建订单（状态：待付款），原子操作扣减库存
3. 如果库存不足，订单创建失败，订单状态为"已取消"，取消原因为"库存不足"
4. 订单创建成功后，跳转到支付页面
5. 系统显示订单信息和支付金额（应用优惠券后）
6. 用户选择支付方式（微信/支付宝）
7. 系统调用支付平台沙箱环境API，生成支付二维码或跳转支付页面
8. 用户完成支付（沙箱环境测试支付）
9. 支付平台回调系统，系统验证支付结果并实现幂等性处理
10. 支付成功，系统更新订单状态为"已付款"，发送邮件通知
11. 支付失败，系统返回错误提示
12. **重要**：以支付平台回调结果为准，前端支付页结果仅作参考
13. **重要**：库存扣减必须在支付前完成，支付成功后才进行后续订单状态更新

#### 4.5.3 功能需求

- **FR-5.1**：系统应集成第三方支付平台（微信支付或支付宝，第一阶段选择一种）
- **FR-5.2**：系统应使用支付平台沙箱环境进行测试（第一阶段）
- **FR-5.3**：系统应支持订单支付功能
- **FR-5.4**：系统应处理支付平台回调，验证支付结果
- **FR-5.5**：系统应实现支付回调的幂等性处理，防止重复回调导致订单状态重复更新（使用唯一交易号或订单号+状态判断）
- **FR-5.6**：支付成功后，系统应更新订单状态为"已付款"
- **FR-5.7**：支付失败时，系统应保持订单为"待付款"状态
- **FR-5.8**：系统应记录支付信息（支付方式、支付时间、交易号等）
- **FR-5.9**：系统应以支付平台回调结果为准，前端支付页结果仅作参考，不能作为最终支付成功的依据
- **FR-5.10**：订单创建时，系统应先检查库存，库存充足则原子操作扣减库存，再创建订单；库存不足则订单创建失败

### 4.6 优惠券系统

#### 4.6.1 描述和优先级

提供优惠券功能，每个新注册用户自动获得10张8折优惠券，用户创建订单时可选择使用优惠券。为未来扩展预留优惠券管理功能。

**优先级**：P1（高优先级）

#### 4.6.2 刺激/响应序列

**优惠券发放流程**：

1. 用户注册成功
2. 系统自动为新用户发放10张8折优惠券

**优惠券使用流程**：

1. 用户创建订单时，进入订单确认页
2. 系统显示用户可用的优惠券列表（8折优惠券）
3. 用户可选择使用优惠券或不用优惠券
4. 如果使用优惠券，系统计算订单金额，应用8折优惠
5. 订单确认页显示订单原价和优惠后价格
6. 优惠券使用后扣除一张

#### 4.6.3 功能需求

- **FR-6.1**：系统应为每个新注册用户自动发放10张8折优惠券
- **FR-6.2**：系统应支持用户查看自己的优惠券列表
- **FR-6.3**：系统应支持用户在创建订单时选择使用优惠券
- **FR-6.4**：系统应支持用户不使用优惠券直接下单
- **FR-6.5**：优惠券为8折优惠，可应用于所有商品（第一阶段仅此一种类型，全商品通用）
- **FR-6.6**：系统应显示订单原价和优惠后价格
- **FR-6.7**：优惠券使用后应扣除一张，未使用的优惠券保留
- **FR-6.8**：优惠券使用必须是原子操作，使用锁机制保证同一张优惠券不会被多个订单同时使用
- **FR-6.9**：系统应为未来优惠券管理功能预留接口（优惠券创建、发放、使用规则、有效期、其他类型等）

### 4.7 收货地址管理

#### 4.7.1 描述和优先级

提供收货地址的增删改查功能，用户可以在创建订单时选择收货地址。

**优先级**：P1（高优先级）

#### 4.7.2 刺激/响应序列

**地址管理流程**：

1. 用户进入"收货地址管理"页面
2. 系统展示用户的所有收货地址
3. 用户点击"添加地址"，填写收货人、联系电话、详细地址
4. 系统保存地址
5. 用户可以编辑、删除已有地址
6. 用户可以设置默认地址
7. 创建订单时，用户可以选择收货地址

#### 4.7.3 功能需求

- **FR-7.1**：系统应支持用户添加收货地址，包含：收货人姓名、联系电话、详细地址
- **FR-7.2**：系统应支持用户编辑收货地址
- **FR-7.3**：系统应支持用户删除收货地址（包括最后一个地址，用户地址列表可以为空）
- **FR-7.4**：系统应支持用户设置默认收货地址
- **FR-7.5**：系统应验证联系电话格式（手机号格式）
- **FR-7.6**：系统应在创建订单时提供地址选择功能
- **FR-7.7**：订单创建时，系统应保存收货地址快照到订单中，用户后续删除地址不影响已创建订单
- **FR-7.8**：系统不验证地址的真实性（第一阶段）

### 4.8 个人中心

#### 4.8.1 描述和优先级

提供用户个人信息管理功能，包括查看个人信息、修改个人信息、修改密码等。

**优先级**：P1（高优先级）

#### 4.8.2 刺激/响应序列

**个人信息查看流程**：

1. 用户进入"个人中心"页面
2. 系统展示用户基本信息（昵称、手机号、邮箱等）

**个人信息修改流程**：

1. 用户在个人中心点击"编辑个人信息"
2. 系统展示个人信息编辑表单
3. 用户修改信息，点击"保存"
4. 系统验证信息格式，更新用户信息

**密码修改流程**：

1. 用户在个人中心点击"修改密码"
2. 用户输入原密码、新密码、确认密码
3. 用户获取验证码（手机或邮箱）
4. 用户输入验证码
5. 系统验证原密码和验证码，更新密码

#### 4.8.3 功能需求

- **FR-8.1**：系统应支持用户查看个人信息
- **FR-8.2**：系统应支持用户修改个人信息（昵称、头像等，手机号和邮箱需验证）
- **FR-8.3**：系统应支持用户修改密码，需验证原密码和验证码
- **FR-8.4**：系统应在个人中心提供订单管理入口
- **FR-8.5**：系统应在个人中心提供地址管理入口
- **FR-8.6**：修改密码时，系统应发送验证码到用户手机或邮箱

### 4.9 销售报表

#### 4.9.1 描述和优先级

为系统管理员和商家提供销售数据统计和报表功能。系统管理员可以查看全平台销售报表（所有店铺数据汇总），商家可以查看自己店铺的销售报表，包括销售额、订单数量、商品销量等统计信息，以及过去一个月的趋势图表。

**优先级**：P1（高优先级）

#### 4.9.2 刺激/响应序列

**管理员报表查看流程**：

1. 系统管理员登录管理后台，进入"销售报表"页面
2. 系统展示全平台总体统计数据：总销售额、总订单数、总商品销量（所有店铺汇总）
3. 系统展示过去一个月的折线图：销售额趋势、订单数趋势、商品销量趋势
4. 系统管理员可以查看不同时间段的统计数据

**商家报表查看流程**：

1. 商家登录商家后台，进入"销售报表"页面
2. 系统展示商家店铺的统计数据：总销售额、总订单数、总商品销量（仅自己店铺）
3. 系统展示过去一个月的折线图：销售额趋势、订单数趋势、商品销量趋势
4. 商家可以查看不同时间段的统计数据

#### 4.9.3 功能需求

- **FR-9.1**：系统应支持系统管理员查看全平台销售报表（所有店铺数据汇总）
- **FR-9.2**：系统应支持商家查看自己店铺的销售报表
- **FR-9.3**：系统应统计总销售额（所有已支付订单的金额总和，排除已退款订单和已取消订单）
- **FR-9.4**：系统应统计总订单数量（所有订单，排除已取消订单和已退款订单）
- **FR-9.5**：系统应统计总商品销量（所有已支付订单的商品数量总和，排除已退款订单和已取消订单）
- **FR-9.6**：系统应使用折线图展示过去一个月的销售额趋势（按中国北京时区统计）
- **FR-9.7**：系统应使用折线图展示过去一个月的订单数趋势（按中国北京时区统计）
- **FR-9.8**：系统应使用折线图展示过去一个月的商品销量趋势（按中国北京时区统计）
- **FR-9.9**：系统应支持按日期范围查询统计数据（时区：中国北京）
- **FR-9.10**：报表数据应实时更新

### 4.10 邮件通知

#### 4.10.1 描述和优先级

系统在关键业务节点发送邮件通知用户，包括订单确认、发货通知等。

**优先级**：P1（高优先级）

#### 4.10.2 刺激/响应序列

**邮件发送流程**：

1. 订单支付成功后，系统触发邮件发送
2. 系统构造邮件内容（订单信息、商品信息、收货地址等）
3. 系统调用邮件服务，发送邮件到用户邮箱
4. 用户收到邮件通知

#### 4.10.3 功能需求

- **FR-10.1**：系统应在订单支付成功后发送订单确认邮件
- **FR-10.2**：系统应在订单发货后发送发货通知邮件（第一阶段：订单支付成功后直接发送"商品已到达"通知）
- **FR-10.3**：邮件内容应包含订单号、商品信息、收货地址、订单金额等
- **FR-10.4**：邮件应使用HTML格式，支持中文显示
- **FR-10.5**：系统应记录邮件发送状态（成功/失败）
- **FR-10.6**：邮件发送失败时，系统应记录错误日志

### 4.11 搜索功能（未来功能）

#### 4.11.1 描述和优先级

提供商品搜索功能，用户可以通过关键词搜索商品。第一阶段不实现，作为高优先级备选功能。

**优先级**：P2（中优先级，第一阶段不实现）

#### 4.11.2 功能需求（预留）

- **FR-11.1**：系统应支持用户通过关键词搜索商品
- **FR-11.2**：搜索结果应按相关度排序
- **FR-11.3**：系统应支持搜索历史记录

### 4.12 操作审计日志

#### 4.12.1 描述和优先级

记录系统管理员和商家的敏感操作，包括商品价格修改、库存修改、订单状态更新、商品删除、店铺管理等，用于审计和问题追踪。系统管理员可以查看所有操作审计日志，商家可以查看自己的操作历史。

**优先级**：P1（高优先级）

#### 4.12.2 刺激/响应序列

**审计日志记录流程**：

1. 系统管理员执行敏感操作（修改商品价格、修改库存、更新订单状态、删除商品等）
2. 系统自动记录操作信息：操作人、操作时间、操作类型、操作内容、操作结果
3. 操作日志保存到数据库
4. 系统管理员可在后台查看操作日志

#### 4.12.3 功能需求

- **FR-12.1**：系统应记录系统管理员的所有敏感操作（商家审核、店铺审核、商品分类管理、订单查看等）
- **FR-12.2**：系统应记录商家修改商品价格的操作（操作人、时间、商品ID、原价格、新价格）
- **FR-12.3**：系统应记录商家修改商品库存的操作（操作人、时间、商品ID、原库存、新库存）
- **FR-12.4**：系统应记录商家删除商品的操作（操作人、时间、商品ID、商品信息）
- **FR-12.5**：系统应记录商家店铺管理的操作（创建、编辑、删除店铺等）
- **FR-12.6**：系统应记录用户删除收货地址的操作（操作人、时间、地址ID）
- **FR-12.7**：系统应支持系统管理员查看所有操作审计日志
- **FR-12.8**：系统应支持商家查看自己的操作历史
- **FR-12.9**：审计日志应包含：操作人ID、操作人姓名、操作时间、操作类型、操作对象、操作内容、操作结果
- **FR-12.10**：审计日志应不可删除和修改，仅支持查询

### 4.13 搜索功能（未来功能）

#### 4.13.1 描述和优先级

提供商品搜索功能，用户可以通过关键词搜索商品。第一阶段不实现，作为高优先级备选功能。

**优先级**：P2（中优先级，第一阶段不实现）

#### 4.13.2 功能需求（预留）

- **FR-13.1**：系统应支持用户通过关键词搜索商品
- **FR-13.2**：搜索结果应按相关度排序
- **FR-13.3**：系统应支持搜索历史记录

### 4.14 商家注册审核

#### 4.14.1 描述和优先级

提供商家注册申请和审核功能。用户可以通过申请成为商家，系统管理员审核商家申请，管理员可以设置开启审核和不审核（审核开关），管理员可以管理商家状态。

**优先级**：P1（高优先级）

#### 4.14.2 刺激/响应序列

**商家申请流程**：

1. 用户登录系统，进入"申请成为商家"页面
2. 用户填写商家信息（商家名称、负责人等）
3. 用户提交商家申请
4. 如果管理员开启了审核，商家申请进入待审核状态；否则直接通过，用户获得商家权限
5. 系统管理员收到商家申请通知（如果开启了审核）

**商家审核流程**：

1. 系统管理员登录管理后台，进入"商家管理"页面
2. 系统展示待审核的商家申请列表
3. 系统管理员查看商家申请详情
4. 系统管理员审核商家申请（同意或拒绝）
5. 如果同意，用户获得商家权限，可以创建店铺
6. 如果拒绝，用户收到拒绝通知

**商家状态管理流程**：

1. 系统管理员登录管理后台，进入"商家管理"页面
2. 系统展示所有商家列表（包括正常、禁用状态）
3. 系统管理员可以启用或禁用商家
4. 商家被禁用后，无法登录商家后台

#### 4.14.3 功能需求

- **FR-14.1**：系统应支持用户申请成为商家
- **FR-14.2**：系统应支持系统管理员审核商家申请（同意或拒绝）
- **FR-14.3**：系统应支持系统管理员设置商家审核开关（开启审核/不审核，默认不审核）
- **FR-14.4**：系统应支持系统管理员管理商家状态（启用/禁用）
- **FR-14.5**：商家申请通过后，用户获得商家权限，可以创建店铺
- **FR-14.6**：商家被禁用后，无法登录商家后台，无法管理店铺和商品

### 4.15 店铺管理

#### 4.15.1 描述和优先级

提供店铺管理功能。商家可以创建、编辑、删除店铺，一个商家最多可以开设3个店铺。店铺的创建可以被管理员设置审核或者不审核（默认不审核），店铺的修改、删除权限由商家自行决定不需要审核，店铺的状态管理员和商家都可以管理。

**优先级**：P1（高优先级）

#### 4.15.2 刺激/响应序列

**店铺创建流程**：

1. 商家登录商家后台，进入"店铺管理"页面
2. 商家检查店铺数量（最多3个）
3. 商家点击"创建店铺"，填写店铺信息（店铺名称、描述等）
4. 系统验证店铺信息，如果管理员开启了店铺审核，则店铺进入待审核状态；否则直接创建成功
5. 系统管理员收到店铺申请通知（如果开启了审核）

**店铺管理流程**：

1. 商家登录商家后台，进入"店铺管理"页面
2. 系统展示商家的所有店铺列表
3. 商家可以编辑店铺信息（不需要审核）
4. 商家可以删除店铺（不需要审核）
5. 商家可以设置店铺状态（启用/禁用）
6. 系统管理员也可以管理所有店铺的状态

#### 4.15.3 功能需求

- **FR-15.1**：系统应支持商家创建店铺，一个商家最多可以开设3个店铺
- **FR-15.2**：系统应支持系统管理员设置店铺创建审核开关（开启审核/不审核，默认不审核）
- **FR-15.3**：系统应支持商家编辑店铺信息（不需要审核）
- **FR-15.4**：系统应支持商家删除店铺（不需要审核）
- **FR-15.5**：系统应支持商家管理店铺状态（启用/禁用）
- **FR-15.6**：系统应支持系统管理员管理所有店铺状态（启用/禁用）
- **FR-15.7**：店铺被禁用后，店铺的商品不可见，无法下单

### 4.16 收藏功能（未来功能）

#### 4.16.1 描述和优先级

提供商品收藏功能，用户可以将喜欢的商品添加到收藏夹。第一阶段不实现。

**优先级**：P3（低优先级，第一阶段不实现）

#### 4.16.2 功能需求（预留）

- **FR-16.1**：系统应支持用户收藏商品
- **FR-16.2**：系统应支持用户查看收藏夹
- **FR-16.3**：系统应支持用户取消收藏

### 4.17 推荐区/热门商品（未来功能）

#### 4.17.1 描述和优先级

在首页提供推荐区或热门商品展示功能。第一阶段不实现。

**优先级**：P3（低优先级，第一阶段不实现）

#### 4.17.2 功能需求（预留）

- **FR-17.1**：系统应在首页展示推荐商品或热门商品
- **FR-17.2**：推荐算法可基于销量、评分等（未来实现）

## 5. 其他非功能性需求

### 5.1 性能需求

- **页面加载时间**：普通页面应在3秒内完成加载
- **API响应时间**：API接口响应时间应在500ms以内（复杂查询可在1秒内）
- **并发用户数**：系统应支持至少100个并发用户同时访问
- **数据库查询**：商品列表查询应在1秒内完成
- **支付处理**：支付流程应在30秒内完成
- **邮件发送**：邮件发送应在10秒内完成（异步处理）

### 5.2 安全性需求

- **数据备份**：系统应定期备份数据库（建议每日备份）
- **异常处理**：系统应妥善处理异常情况，避免数据丢失
- **事务管理**：关键业务操作（如订单创建、库存扣减、优惠券使用）应使用数据库事务保证数据一致性
- **并发控制**：系统应实现并发控制机制，确保库存扣减和优惠券使用的原子性，防止并发操作导致数据不一致
- **日志记录**：系统应记录关键操作日志，便于问题追踪

### 5.3 安全需求

- **身份认证**：所有需要身份验证的操作必须验证用户身份
- **密码安全**：用户密码必须加密存储，使用BCrypt等安全加密算法
- **会话管理**：用户会话应设置超时时间（建议30分钟无操作自动退出）
- **API安全**：API接口应进行身份认证和授权验证，防止未授权访问
- **SQL注入防护**：使用参数化查询，防止SQL注入攻击
- **XSS防护**：对用户输入进行过滤和转义，防止跨站脚本攻击
- **CSRF防护**：实施CSRF令牌验证
- **敏感信息保护**：用户密码、支付信息等敏感数据不得在日志中明文记录
- **HTTPS**：生产环境必须使用HTTPS协议

### 5.4 软件质量属性

- **可用性**：系统可用性应达到99%以上（排除计划维护时间）
- **可维护性**：代码应遵循编码规范，具有良好的可读性和可维护性
- **可扩展性**：系统架构应支持未来功能扩展（如商家功能、搜索功能等）
- **可靠性**：系统应能够处理异常情况，避免崩溃
- **易用性**：界面应简洁直观，操作流程清晰，符合用户使用习惯
- **兼容性**：前端应兼容主流浏览器（Chrome、Firefox、Safari、Edge最新版本）
- **可测试性**：代码应具有良好的可测试性，支持单元测试和集成测试

### 5.5 业务规则

- **用户角色规则**：

  - 顾客可以注册账户（手机号或邮箱二选一），系统管理员账户由管理员手动创建（通过数据库或配置文件）
  - 顾客只能查看和管理自己的订单和信息
  - 商家由用户申请成为商家，由系统管理员审核，管理员可以设置开启审核和不审核（审核开关）
  - 商家的状态由管理员管理（启用/禁用）
  - 系统管理员可以管理所有商家、店铺、商品分类，查看所有订单，查看全平台销售报表，审核所有退款
  - 商家可以管理自己的店铺、商品、查看自己店铺的订单和报表，审核自己店铺的退款

- **用户认证规则**：

  - 支持手机号/邮箱和密码登录
  - 支持手机号和短信验证码免密码登录
  - 密码登录时需输入图片验证码（次优先级P2，第一阶段可选）
  - 忘记密码可通过验证码重置

- **商家和店铺规则**：

  - 一个商家最多可以开设3个店铺
  - 店铺的创建可以被管理员设置审核或者不审核（默认不审核，审核开关）
  - 店铺的修改、删除权限由商家自行决定，不需要审核
  - 店铺的状态管理员和商家都可以管理
  - 商家可以自由管理自己店铺的商品（增删改查、上架/下架、库存管理）
  - 商品的创建也是同样的管理员选择开启审核或者不审核（默认不审核，审核开关）
  - 商品的分类可以由商家创建，管理员可以管理全局商品分类
  - 商品可被商家自由上下架和管理

- **商品规则**：

  - 商品属于店铺，每个商品必须关联到一个店铺
  - 商品库存不能为负数
  - 库存为0的商品不能购买，显示"无货"状态
  - 库存≤50的商品需要显示预警
  - 商品有上架/下架状态，用户只能看到上架商品
  - 商品下架和库存为0是两个独立的状态，商品下架不影响库存
  - 商品下架后，用户仍可通过查找功能找到商品，但无法下单
  - 新添加商品默认为下架状态
  - 商品删除操作需记录审计日志
  - 订单创建时需保存商品快照（商品名称、价格、图片等），确保商品信息变化时订单金额不变
  - 商品浏览支持显示店铺信息，点击店铺只能看到该店铺的商品

- **订单规则**：

  - 订单可以包含不同店铺的商品，订单项按店铺区分
  - 订单提交时，系统先检查库存，库存充足则原子操作扣减库存，再创建订单；库存不足则订单创建失败，订单状态为"已取消"，取消原因为"库存不足"
  - 库存扣减必须是原子操作，确保并发下单时库存扣减正确
  - 订单创建时保存商品快照和收货地址快照
  - 订单取消时恢复库存
  - 只有"待付款"和"待发货"状态的订单可以取消
  - 订单创建后30分钟内未支付，系统自动取消订单，恢复库存，并通知用户（30分钟时间可配置）
  - 订单支付成功后，订单状态依次更新为：已付款→待发货→已发货→运输中→已送到（当前阶段全部都是系统自动更新）
  - 订单状态变为"已送到"后，立即发送短信通知用户"商品已到达指定收货地址"（第一阶段简化流程）
  - 用户可在"已送到"状态主动确认收货，订单状态更新为"已完成"
  - 如果用户未主动确认，系统在订单状态变为"已送到"后24小时自动更新订单状态为"已完成"
  - 订单状态：待付款、已付款、待发货、已发货、运输中、已送到、已完成、已取消、已退款
  - 管理员可以查看所有订单
  - 商家只能查看自己店铺的订单，订单项按店铺区分，商家只能看到自己店铺的订单项

- **退款规则**：

  - 支持7天无理由退款
  - 订单完成7天内可申请退款
  - 退款申请有独立的状态：待审核、已同意、已拒绝
  - 退款申请提交成功后，商家可以审核自己店铺的退款申请，管理员也可以审核所有退款申请
  - 退款申请提交成功后，在配置的时间内（默认2分钟，可配置，主要用于测试）未确认，则自动同意退款
  - 退款成功后，更新退款申请状态为"已同意"，更新订单状态为"已退款"，恢复商品库存，发送短信通知用户，并处理退款
  - 退款成功后商品库存恢复（第一阶段）

- **支付规则**：

  - 使用支付平台沙箱环境进行测试（第一阶段）
  - 订单创建时先检查库存并原子操作扣减库存，再创建订单
  - 支付回调需实现幂等性处理，防止重复回调
  - 以支付平台回调结果为准，前端支付页结果仅作参考
  - 支付成功后才进行后续订单状态更新

- **优惠券规则**：

  - 每个新注册用户自动获得10张8折优惠券
  - 第一阶段仅有一种优惠券类型：全商品通用8折优惠券
  - 用户创建订单时可选择使用优惠券或不用
  - 优惠券使用后扣除一张
  - 优惠券使用必须是原子操作，使用锁机制保证同一张优惠券不会被多个订单同时使用
  - 优惠券功能为未来扩展预留（有效期、使用规则、其他类型等）

- **报表统计规则**：

  - 管理员可以查看全平台销售报表（所有店铺数据汇总）
  - 商家只能查看自己店铺的销售报表
  - 总销售额统计排除已退款订单和已取消订单
  - 总订单数统计排除已取消订单和已退款订单
  - 时间维度统计按中国北京时区

- **地址规则**：

  - 订单创建时保存收货地址快照到订单中，用户后续删除地址不影响已创建订单
  - 用户地址列表可以为空，可以删除最后一个地址
  - 地址不进行真实性验证（第一阶段）
  - 删除地址操作需记录审计日志

- **并发控制规则**：

  - 库存扣减必须是原子操作，使用数据库锁或分布式锁保证并发安全
  - 优惠券使用必须是原子操作，使用锁机制保证同一张优惠券不会被多个订单同时使用
  - 支付回调处理需实现幂等性，防止重复处理

- **审计日志规则**：

  - 记录系统管理员的所有敏感操作（商家审核、店铺审核、商品分类管理、订单查看等）
  - 记录商家的敏感操作（修改商品价格、修改库存、删除商品、店铺管理等）
  - 记录用户删除收货地址的操作
  - 管理员可以查看所有操作审计日志
  - 商家可以查看自己的操作历史
  - 审计日志不可删除和修改，仅支持查询

## 6. 其他需求

### 6.1 数据库需求

- 数据库应支持事务处理，保证数据一致性
- 数据库应建立适当的索引，优化查询性能
- 数据库应定期备份，支持数据恢复
- 数据库设计应考虑未来扩展需求
- **数据量预期**：
  - 商品数据：10万级别
  - 用户数据：千到万级别
  - 订单数据：根据用户量和业务增长预期设计

### 6.2 缓存需求

- 系统应使用Redis缓存热门数据，提升系统性能
- **需要缓存的数据**（第一阶段）：
  - 商品列表（分页、分类筛选结果）
  - 商品详情
  - 其他热门数据（具体哪些数据需要缓存，后续详细设计文档中讨论）
- 缓存应设置合理的过期时间
- 缓存更新策略：商品信息更新时，应同步更新或清除相关缓存

### 6.3 日志需求

- 系统应记录用户操作日志（登录、订单创建、支付等）
- 系统应记录错误日志，便于问题排查
- 日志应包含时间戳、用户信息、操作类型、操作结果等
- 日志应定期归档，避免占用过多存储空间
- 系统应记录审计日志（见4.12节）

### 6.4 监控需求

- 系统应监控关键指标（API响应时间、错误率、数据库连接数等）
- 系统应在异常情况时发送告警通知

### 6.5 国际化需求

- 当前阶段仅支持中文界面和中文内容
- 未来可能考虑支持英文等多语言（第一阶段不考虑）

### 6.6 用户协议和隐私政策

- 用户协议和隐私政策链接功能为低优先级（P3），第一阶段不实现
- 第一阶段产品不用于实际商业使用，暂不需要用户协议和隐私政策页面

### 6.7 未来扩展需求

以下功能为未来扩展预留，第一阶段不实现：

- 商家角色和店铺功能
- 商品评价和评分功能
- 商品搜索功能（高优先级备选P2）
- 商品收藏功能（低优先级P3）
- 推荐区/热门商品功能（低优先级P3）
- 物流跟踪功能
- 优惠券管理功能（创建、发放、使用规则、有效期等）
- 图片验证码功能（次优先级P2，第一阶段可选）
- 商品草稿功能（次优先级P2）
- 用户协议和隐私政策页面（低优先级P3）
- 移动端应用

## 附录 A：术语表

- **SRS**：Software Requirements Specification，软件需求规格说明
- **API**：Application Programming Interface，应用程序编程接口
- **JWT**：JSON Web Token，一种用于身份认证的令牌格式
- **RESTful**：Representational State Transfer，一种Web服务架构风格
- **ORM**：Object-Relational Mapping，对象关系映射
- **SMTP**：Simple Mail Transfer Protocol，简单邮件传输协议
- **HTTPS**：HyperText Transfer Protocol Secure，安全超文本传输协议
- **CSRF**：Cross-Site Request Forgery，跨站请求伪造
- **XSS**：Cross-Site Scripting，跨站脚本攻击
- **SQL注入**：通过SQL语句注入恶意代码的攻击方式
- **BCrypt**：一种密码加密算法
- **DaisyUI**：基于Tailwind CSS的组件库
- **Vite**：前端构建工具
- **Spring Boot**：Java Web应用框架
- **Vue.js**：前端JavaScript框架
- **TypeScript**：JavaScript的超集，添加了类型系统
- **Redis**：内存数据库，用于缓存热门数据
- **幂等性**：同一操作执行多次和执行一次的效果相同，用于防止重复操作
- **沙箱环境**：支付平台的测试环境，用于开发测试，不涉及真实资金

## 附录 B：分析模型

### B.1 用户角色关系图

```
顾客 (Customer)
  ├── 注册/登录
  ├── 浏览商品（支持店铺信息）
  ├── 购物车管理
  ├── 订单管理（可包含不同店铺商品）
  ├── 地址管理
  ├── 个人中心
  └── 申请成为商家

系统管理员 (System Administrator)
  ├── 登录（手动创建账户）
  ├── 商家管理（审核商家申请、管理商家状态、审核开关配置）
  ├── 店铺管理（审核店铺、管理店铺状态、审核开关配置）
  ├── 商品分类管理（全局分类管理）
  ├── 订单管理（查看所有订单）
  ├── 销售报表（全平台数据汇总）
  ├── 退款审核（审核所有退款）
  └── 操作审计日志查看（查看所有日志）

商家 (Merchant)
  ├── 登录（申请成为商家，管理员审核）
  ├── 店铺管理（创建、编辑、删除店铺，最多3个，店铺状态管理）
  ├── 商品管理（增删改查、上架/下架、库存管理、商品分类创建）
  ├── 订单管理（查看自己店铺的订单）
  ├── 销售报表（查看自己店铺的报表）
  ├── 退款审核（审核自己店铺的退款）
  └── 操作审计日志查看（查看自己的操作历史）
```

### B.2 订单状态转换图

```
待付款 → 已付款 → 待发货 → 已发货 → 运输中 → 已送到 → 已完成
  ↓         ↓                                                      ↓
已取消   已取消                                                 已退款
```

**说明**：
- 订单提交时检查库存，库存不足则订单状态为"已取消"，取消原因为"库存不足"
- 用户可在"待付款"和"待发货"状态取消订单
- 订单创建后30分钟内未支付，自动取消订单
- 订单支付成功后，状态依次更新为：已付款→待发货→已发货→运输中→已送到
- 订单状态变为"已送到"后，立即发送短信通知用户
- 用户可在"已送到"状态主动确认收货，订单状态更新为"已完成"
- 如果用户未主动确认，系统在订单状态变为"已送到"后24小时自动更新订单状态为"已完成"
- 订单完成后7天内可申请退款
- 退款申请有独立状态：待审核、已同意、已拒绝

### B.3 核心业务流程

**购物流程**：
用户浏览商品 → 加入购物车/直接购买 → 选择收货地址 → 选择优惠券 → 提交订单（检查库存、扣减库存） → 支付 → 订单状态更新 → 已送到通知 → 确认收货/自动确认 → 订单完成

**订单创建流程**：
用户提交订单 → 系统检查库存 → 库存充足：原子操作扣减库存 → 创建订单（保存商品快照、地址快照） → 订单状态：待付款
库存不足：订单创建失败 → 订单状态：已取消（原因：库存不足）

**退款流程**：
用户申请退款 → 选择退款原因 → 创建退款申请（状态：待审核） → 系统管理员审核 → 同意：更新退款申请状态为"已同意"，订单状态为"已退款"，恢复库存，发送通知
拒绝：更新退款申请状态为"已拒绝"，用户可查看拒绝原因
自动退款：退款申请提交后，系统管理员在配置时间内未确认，自动同意退款

**商品管理流程**：
系统管理员登录 → 商品管理 → 添加/编辑/删除商品 → 设置上架/下架 → 库存管理 → 库存预警

## 附录 C：待确定事项列表

以下事项需要在后续阶段确定：

1. **TBD-1**：订单号生成规则和格式
2. **TBD-2**：支付平台选择（微信支付或支付宝，第一阶段选择一种）
3. **TBD-3**：邮件服务提供商选择（QQ邮箱、163邮箱、SendGrid等）
4. **TBD-4**：短信服务提供商选择（如需要短信功能）
5. **TBD-5**：数据库选择（MySQL或PostgreSQL）
6. **TBD-6**：商品图片存储方案（本地存储或云存储）
7. **TBD-7**：系统部署方案（服务器配置、域名、SSL证书等）
8. **TBD-8**：日志存储方案和归档策略
9. **TBD-9**：监控工具选择
10. **TBD-10**：API文档工具选择（Swagger/OpenAPI）
